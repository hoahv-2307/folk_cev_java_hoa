<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
</head>
<body>
    <!-- Admin JavaScript functionality fragment -->
    <script th:fragment="admin-foods-scripts">
        (function(){
          const searchInput = document.getElementById("searchInput");
          const categoryFilter = document.getElementById("categoryFilter");
          const rowsSelector = ".food-row";

          if (searchInput) {
            searchInput.addEventListener("keyup", function (e) {
              const searchTerm = e.target.value.toLowerCase();
              const rows = document.querySelectorAll(rowsSelector);

              rows.forEach((row) => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? "" : "none";
              });
            });
          }

          if (categoryFilter) {
            const applyCategoryFilter = function(e) {
              const category = e.target.value;
              const rows = document.querySelectorAll(rowsSelector);
              rows.forEach((row) => {
                if (category === "" || row.textContent.includes(category)) {
                  row.style.display = "";
                } else {
                  row.style.display = "none";
                }
              });
            };
            categoryFilter.addEventListener("change", applyCategoryFilter);
          }

          document.getElementById("add-food-btn").addEventListener("click", function () {
            fetch("/admin/foods/create")
              .then((response) => response.text())
              .then((html) => {
                const modalContainer = document.getElementById("foodModalContainer");
                modalContainer.innerHTML = html;
                
                const scripts = modalContainer.querySelectorAll("script");
                scripts.forEach((script) => {
                  if (script.src) {
                    const newScript = document.createElement("script");
                    newScript.src = script.src;
                    document.head.appendChild(newScript);
                  } else {
                    eval(script.textContent);
                  }
                });
                
                const addFoodModal = new bootstrap.Modal(
                  modalContainer.querySelector("#addFoodModal")
                );
                addFoodModal.show();
              })
              .catch((error) => console.error("Error loading add modal:", error));
          });

          document.querySelectorAll(".btn-outline-primary").forEach((btn) => {
            btn.addEventListener("click", function () {
              const foodId = this.getAttribute("data-food-id");
              fetch(`/admin/foods/edit/${foodId}`)
                .then((response) => response.text())
                .then((html) => {
                  const modalContainer = document.getElementById("foodModalContainer");
                  modalContainer.innerHTML = html;
                  
                  const scripts = modalContainer.querySelectorAll("script");
                  scripts.forEach((script) => {
                    if (script.src) {
                      const newScript = document.createElement("script");
                      newScript.src = script.src;
                      document.head.appendChild(newScript);
                    } else {
                      eval(script.textContent);
                    }
                  });
                  
                  const addFoodModal = new bootstrap.Modal(
                    modalContainer.querySelector("#addFoodModal")
                  );
                  addFoodModal.show();
                })
                .catch((error) => console.error("Error loading edit modal:", error));
            });
          });
        })();
    </script>
</body>
</html>