<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/common/common-libs-script :: common-head('Food Menu - Foods App')}">
</head>
<head>
    <div th:replace="~{fragments/user/user-styles :: user-styles}"></div>
</head>
<body>
    <!-- Navigation -->
    <div th:replace="~{fragments/user/user-header :: user-header}"></div>

    <!-- Suggestion button -->
    <div class="container mt-3 text-end">
        <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#addSuggestionModal">
            <i class="fas fa-lightbulb me-1"></i>Suggest a Food
        </button>
    </div>

    <!-- Search and Filter Section -->
    <div th:replace="~{fragments/user/user-search :: user-search}"></div>

    <!-- Food Grid -->
    <div class="container mb-5">
        <div class="row" id="foodGrid">
            <div th:each="food : ${foods}" class="col-lg-4 col-md-6 mb-4 food-item" 
                 th:data-category="${food.category}" th:data-price="${food.price}" 
                 th:data-name="${food.name}" th:data-id="${food.id}">
                <div class="card meal-card position-relative h-100">
                    <!-- Food Image -->
                    <div th:if="${!#lists.isEmpty(food.foodImages)}" class="food-img-wrapper" th:data-id="${food.id}">
                        <img th:src="@{/api/foods/images/{filename}(filename=${food.foodImages[0].imageUrl})}" 
                             class="card-img-top food-image" 
                             th:alt="${food.name}"
                             style="height: 200px; object-fit: cover; cursor: pointer;"
                             th:onerror="this.onerror=null; this.src='/no-image.png';" />
                    </div>
                    <div th:if="${#lists.isEmpty(food.foodImages)}"  th:data-id="${food.id}"
                         class="food-img-wrapper d-flex align-items-center justify-content-center bg-light" 
                         style="height: 200px; cursor: pointer;">
                         <i class="fas fa-utensils fa-3x text-muted"></i>
                    </div>
                    
                    <div class="card-body p-4">
                        <!-- Price Badge -->
                        <div class="price-badge">$<span th:text="${food.price}">0.00</span></div>
                        
                        <!-- Category Tag -->
                        <span class="category-tag" th:text="${food.category}">Category</span>
                        
                        <!-- Food Info -->
                        <a th:href="@{/foods/{id}(id=${food.id})}" class="text-decoration-none">
                            <h5 class="card-title mt-3 mb-2" th:text="${food.name}">Food Name</h5>
                        </a>
                        <div class="mb-2">
                            <span class="fw-bold" th:text="${food.averageRating}">0.0</span>
                            <i class="fas fa-star text-warning"></i>
                            <small class="text-muted">(<span th:text="${food.ratingCount}">0</span>)</small>
                        </div>
                        <p class="card-text text-muted mb-3" th:text="${food.description}">Description</p>
                        
                        <!-- Availability Status -->
                        <div class="mb-3">
                            <span th:if="${food.quantity > 0 and food.status == 'ACTIVE'}" 
                                  class="badge bg-success small"
                                  th:text="${food.quantity} + ' in stock'">0 in stock</span>
                            <span th:if="${food.quantity == 0 or food.status != 'ACTIVE'}" 
                                  class="badge bg-danger small">
                                <span th:if="${food.status == 'DISCONTINUED'}">Discontinued</span>
                                <span th:if="${food.status == 'INACTIVE'}">Temporarily Unavailable</span>
                                <span th:if="${food.quantity == 0 and food.status == 'ACTIVE'}">Out of Stock</span>
                            </span>
                            <span th:if="${food.quantity > 0 and food.quantity <= 5 and food.status == 'ACTIVE'}" 
                                  class="badge bg-warning small ms-1">Low Stock</span>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="action-buttons">
                            <button class="btn btn-outline-danger btn-sm favorite-btn" 
                                    th:data-id="${food.id}"
                                    onclick="toggleFavorite(this)">
                                <i class="fas fa-heart"></i>
                            </button>
                            <button th:class="${food.quantity > 0 and food.status == 'ACTIVE'} ? 'btn btn-primary btn-sm' : 'btn btn-secondary btn-sm'"
                                    th:data-id="${food.id}" 
                                    th:data-name="${food.name}" 
                                    th:data-price="${food.price}"
                                    th:disabled="${food.quantity == 0 or food.status != 'ACTIVE'}"
                                    onclick="addToCartFromButton(this)">
                                <i class="fas fa-plus me-1"></i>
                                <span th:if="${food.status == 'DISCONTINUED'}">Discontinued</span>
                                <span th:if="${food.status == 'INACTIVE'}">Unavailable</span>
                                <span th:if="${food.quantity == 0 and food.status == 'ACTIVE'}">Sold Out</span>
                                <span th:if="${food.quantity > 0 and food.status == 'ACTIVE'}">Add</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Empty State -->
        <div class="text-center py-5" id="emptyState" style="display: none;">
            <i class="fas fa-search fa-3x text-muted mb-3"></i>
            <h5 class="text-muted">No foods found</h5>
            <p class="text-muted">Try adjusting your search or filter criteria</p>
        </div>
    </div>

    <!-- Cart Sidebar and Toast -->
    <div th:replace="~{fragments/user/user-cart :: user-cart}"></div>

    <!-- Scripts -->
    <div th:replace="~{fragments/common/common-libs-script :: common-libs-script}"></div>
    <div th:replace="~{fragments/user/user-scripts :: user-scripts}"></div>
    <div th:replace="~{fragments/common/common-script :: common-script}"></div>
    <div th:replace="~{fragments/user/user-add-suggestion :: add-suggestion-modal}"></div>
</body>
</html>